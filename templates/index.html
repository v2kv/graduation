{% extends 'layout.html' %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center mb-4">Welcome to the E-commerce Website</h1>
    <p class="text-center">Explore our wide range of products and find the best deals!</p>

    <!-- Search Bar -->
    <div class="row justify-content-center mb-4">
        <div class="col-md-8">
            <input 
                type="text" 
                id="searchBar" 
                class="form-control" 
                placeholder="Search for products..." 
            />
        </div>
    </div>

    <!-- Products Grid -->
    <div class="row" id="productGrid">
        {% for item in items %}
        <div class="col-md-4 col-sm-6 mb-4 product-card" data-name="{{ item.item_name | lower }}" data-description="{{ item.item_description | lower }}">
            <div class="card shadow-sm h-100">
                <!-- Product Image -->
                {% if item.images %}
                <img 
                    src="{{ item.images[0].image_url }}" 
                    class="card-img-top" 
                    alt="{{ item.item_name }}" 
                    style="height: 200px; object-fit: cover;"
                >
                {% else %}
                <img 
                    src="https://via.placeholder.com/300x200?text=No+Image" 
                    class="card-img-top" 
                    alt="No Image Available" 
                >
                {% endif %}

                <!-- Product Details -->
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">{{ item.item_name }}</h5>
                    <p class="card-text text-muted">{{ item.item_description[:100] }}...</p>
                    <p class="card-text fw-bold text-primary mb-3">${{ item.item_price }}</p>
                    <!-- Fixed the endpoint -->
                    <a href="{{ url_for('item.item_detail', item_id=item.item_id) }}" class="btn btn-primary mt-auto">View Details</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    // Search functionality for filtering products
    const searchBar = document.getElementById('searchBar');
    const productCards = document.querySelectorAll('.product-card');

    searchBar.addEventListener('input', function () {
        const searchText = searchBar.value.toLowerCase();

        productCards.forEach(function (card) {
            const name = card.getAttribute('data-name');
            const description = card.getAttribute('data-description');

            // Show card if the search text matches the product name or description
            if (name.includes(searchText) || description.includes(searchText)) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    });
</script>
{% endblock %}