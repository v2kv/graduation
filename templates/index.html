{% extends 'layout.html' %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="text-center my-5">
    <h1>Welcome to Our E-commerce Store</h1>
    <p>Discover the best products at unbeatable prices!</p>
</div>

<div class="row mb-4">
    <div class="col-md-8">
        <input type="text" id="search-bar" class="form-control" placeholder="Search for products...">
    </div>
    <div class="col-md-4">
        <select id="filter-category" class="form-select">
            <option value="">Filter by Category</option>
            {% for category in categories %}
                <option value="{{ category.category_id }}">{{ category.category_name }}</option>
            {% endfor %}
        </select>
    </div>
</div>

<div id="product-grid" class="row">
    {% for item in items %}
        <div class="col-md-4 mb-4">
            <div class="card h-100 shadow-sm" data-category="{{ item.category_id }}">
                {% if item.images and item.images|length > 0 %}
                    <img src="{{ url_for('static', filename='' + item.images[0].image_url) }}" class="card-img-top" alt="{{ item.item_name }}">
                {% else %}
                    <img src="{{ url_for('static', filename='images/no_image.png') }}" class="card-img-top" alt="No Image">
                {% endif %}
                <div class="card-body">
                    <h5 class="card-title">{{ item.item_name }}</h5>
                    <p class="card-text">{{ item.item_description[:100] }}...</p>
                    <p class="card-text"><strong>${{ item.item_price }}</strong></p>
                    <button class="btn btn-primary add-to-cart" data-item-id="{{ item.item_id }}">üõí Add to Cart</button>
                    <button class="btn btn-secondary add-to-wishlist" data-item-id="{{ item.item_id }}">‚≠ê Add to Wishlist</button>
                </div>
            </div>
        </div>
    {% endfor %}
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const searchBar = document.getElementById('search-bar');
        const filterCategory = document.getElementById('filter-category');

        searchBar.addEventListener('input', filterItems);
        filterCategory.addEventListener('change', filterItems);

        function filterItems() {
            const query = searchBar.value.toLowerCase();
            const category = filterCategory.value;

            document.querySelectorAll('.card').forEach(card => {
                const title = card.querySelector('.card-title').textContent.toLowerCase();
                const cardCategory = card.getAttribute('data-category');

                const matchesQuery = query === '' || title.includes(query);
                const matchesCategory = category === '' || cardCategory === category;

                card.style.display = matchesQuery && matchesCategory ? '' : 'none';
            });
        }

        document.querySelectorAll('.add-to-cart').forEach(button => {
            button.addEventListener('click', function () {
                const itemId = this.dataset.itemId;
                fetch(`/cart/add/${itemId}`, { method: 'POST' })
                    .then(response => alert('Item added to cart!'))
                    .catch(() => alert('Error adding to cart'));
            });
        });

        document.querySelectorAll('.add-to-wishlist').forEach(button => {
            button.addEventListener('click', function () {
                const itemId = this.dataset.itemId;
                fetch(`/wishlist/add/${itemId}`, { method: 'POST' })
                    .then(response => alert('Item added to wishlist!'))
                    .catch(() => alert('Error adding to wishlist'));
            });
        });
    });
</script>
{% endblock %}