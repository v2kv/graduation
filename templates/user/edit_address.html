{% extends "layout.html" %}

{% block title %}Edit Address{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Edit Address</h2>
    <form method="POST">
        <div class="form-group">
            <label for="address_line">Address Line</label>
            <input
                type="text"
                name="address_line"
                id="address_line"
                class="form-control"
                value="{{ address.address_line }}"
                required
            >
        </div>
        <div class="form-group">
            <label for="city">City</label>
            <input
                type="text"
                name="city"
                id="city"
                class="form-control"
                value="{{ address.city }}"
                required
            >
        </div>
        <div class="form-group">
            <label for="country">Country</label>
            <select name="country" id="country" class="form-control" required>
                {% for country in countries %}
                    <option value="{{ country }}" {% if country == address.country %}selected{% endif %}>
                        {{ country }}
                    </option>
                {% endfor %}
            </select>
        </div>
        {% if address.country == "Iraq" %}
            <div class="form-group">
                <label for="governerate">Governorate</label>
                <select name="governerate" id="governerate" class="form-control" required>
                    <option value="" disabled>Select a Governorate</option>
                    {% for governorate in governorates %}
                        <option value="{{ governorate }}" {% if governorate == address.governerate %}selected{% endif %}>
                            {{ governorate }}
                        </option>
                    {% endfor %}
                </select>
            </div>
        {% endif %}
        <div class="form-group">
            <label for="postal_code">Postal Code</label>
            <input
                type="text"
                name="postal_code"
                id="postal_code"
                class="form-control"
                value="{{ address.postal_code }}"
            >
        </div>
        <div class="form-group">
            <label for="phone_number">Phone Number</label>
            <input
                type="text"
                name="phone_number"
                id="phone_number"
                class="form-control"
                value="{{ address.phone_number }}"
                required
            >
        </div>
        <!-- Show "Set as Default" only if not already the default address -->
        {% if not address.is_default %}
            <div class="form-check">
                <input
                    type="checkbox"
                    name="is_default"
                    id="is_default"
                    class="form-check-input"
                >
                <label for="is_default" class="form-check-label">Set as Default</label>
            </div>
        {% endif %}
        <button type="submit" class="btn btn-primary">Save Changes</button>
    </form>
</div>

<script>
    const countrySelect = document.getElementById("country");
    const governerateGroup = document.getElementById("governerate-group");
    const phoneInput = document.getElementById("phone_number");

    function updateFields() {
        if (countrySelect.value === "Iraq") {
            governerateGroup.style.display = "block";
            phoneInput.placeholder = "07XXXXXXXXX";
        } else {
            governerateGroup.style.display = "none";
            phoneInput.placeholder = "";
        }
    }

    countrySelect.addEventListener("change", updateFields);
    window.onload = updateFields;
</script>
{% endblock %}